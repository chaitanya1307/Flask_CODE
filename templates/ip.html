<!DOCTYPE html>
<html>
  {% include 'head.html' %}
<body align="center">
  {% include 'navigation.html' %}
  <form action="/iplocation" method="post">
    <div class="container">
      <div class="row mt-4">
         <div class="col-md-12">
            <h1>IP Geolocation API</h1>
            <div id="error"></div>
            <!-- <form id="geo"> -->
               <div class="form-group">
                  <label for="ip_address">IP Address</label>
                  <input type="text" class="form-control" id="ip_address" name="ip_address" placeholder="Enter IP Address">
               </div>
               <button type="submit" class="btn btn-primary">Submit</button>
            <!-- </form> -->
         </div>
      </div>
      <div class="row mt-4">
         <div class="table-responsive">
            <table class="table table-bordered">
               <thead>
                  <th>Flag</th>
                  <th>IP Address</th>
                  <th>Country Name</th>
                  <th>City</th>
                  <th>Country Currency</th>
                  <th>Continent</th>
                  <th>Timezone</th>
               </thead>
               <tbody>
               </tbody>
            </table>
         </div>
      </div>
   </div>
   <script>
      $(".btn-primary").on("click", function(e) {
          e.preventDefault();
          var ip_address = $("#ip_address").val();
          $.ajax({
              url: "{{url_for('ip_location')}}",
              method: "POST",
              data: {
                  ip_address: ip_address
              },
              beforeSend:function(){
                  // show loader button
                  $("#geo").find(".btn-primary").html("<i class='fa fa-spinner fa-spin'></i>");
              },
              success: function(data){
                  $(".table-bordered tbody").html("");
                  var html = "";
                  html += "<tr>";
                  html += "<td><img width='100' height='100' src='"+data.flag.png+"'></td>";
                  html += "<td>"+data.ip_address+"</td>";
                  html += "<td>"+data.country+"</td>";
                  html += "<td>"+data.city+"</td>";
                  html += "<td>"+data.currency.currency_name+"</td>";
                  html += "<td>"+data.continent+"</td>";
                  html += "<td>"+data.timezone.name+"</td>";
                  html += "</tr>";
                  $(".table-bordered tbody").append(html);
      
                  // hide loader button
                  $("#geo").find(".btn-primary").html("Submit");
              },
              error: function(err){
                  console.log(err);
                  $("#error").html(err.error);
                  // hide loader button
                  $("#geo").find(".btn-primary").html("Submit");
              }
          })
      })
   </script>
</body>
</html>